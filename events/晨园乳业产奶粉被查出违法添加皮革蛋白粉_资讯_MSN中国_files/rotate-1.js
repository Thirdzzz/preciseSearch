if(typeof __init_RotateAd__=="undefined"){__init_RotateAd__=1;if(typeof cn=="undefined"){var cn=new Object()}if(typeof cn.diny=="undefined"){cn.diny=new Object()}RotateAd={BASE_WEIGHT:100,ZT_PRICING_TIME:1,ZT_PRICING_COUNT:2,ZT_ROTATION_CLIENT:1,ZT_ROTATION_SERVER:2,ZT_MODE_ORDER:1,ZT_MODE_WEIGHT:2,ZT_ALGO_NONE:0,ZT_ALGO_PRI_ORDER:1,ZT_ALGO_ORDER:2,ZT_ALGO_PRI_WEIGHT:3,ZT_ALGO_WEIGHT:4,ZT_ALGO_PRI_WEIGHT_MUL:5,debug:true,list:Array(),length:function(){return RotateAd.list.length},find:function(c){var a=RotateAd.list.length;for(var b=0;b<a;++b){if(RotateAd.list[b].id==c){return b}}return -1},error:function(b,a){if(RotateAd.debug){document.write("<!-- RotateAd:"+b+" [ERR] "+a+" -->")}},add:function(d,c){var b=RotateAd.find(d);var a;if(b==-1){b=RotateAd.length();RotateAd.list[b]=new Object();RotateAd.list[b].id=d;RotateAd.list[b].side=c.channel_rotation_side;RotateAd.list[b].mode=c.channel_rotation_mode;RotateAd.list[b].algo=c.channel_delivery_algorithm;RotateAd.list[b].list=Array()}a=RotateAd.list[b].list;a[a.length]=c},set_side:function(c,b){var a=RotateAd.find(c);if(a!=-1){RotateAd.list[a].side=b}},set_mode:function(c,b){var a=RotateAd.find(c);if(a!=-1){RotateAd.list[a].mode=b}},set_delivery_algo:function(c,b){var a=RotateAd.find(c);if(a!=-1){RotateAd.list[a].algo=b}},fix_weight:function(a){var b,c;c=a.length;for(b=0;b<c;++b){a[b].ad_rotation_weight=(RotateAd.BASE_WEIGHT-a[b].ad_priority_level)*a[b].ad_rotation_weight}return a},select_by_priority:function(b){var e,f,d=65536;var c=new Array,a=0;f=b.length;if(f==1){c[a]=b[0];return c}if(f==0){return c}for(e=0;e<f;++e){if(b[e].ad_priority_level<d){d=b[e].ad_priority_level}}for(e=0;e<f;++e){if(b[e].ad_priority_level==d){c[a++]=b[e]}}return c},select_by_weight:function(a){var e=0,b,f,d=0,c;f=a.length;if(f==1){return a[0]}if(f<=0){return null}for(b=0;b<f;++b){if(a[b].ad_rotation_weight<=0){continue}d+=a[b].ad_rotation_weight}if(d==0){return null}c=Math.round(Math.random()*(d-1))+1;for(b=0;b<f;++b){if(a[b].ad_rotation_weight<=0){continue}e+=a[b].ad_rotation_weight;if(c<=e){return a[b]}}return null},select_by_order:function(b){var d,e,c=65536,a=0;e=b.length;if(e==1){return b[0]}if(e<=0){return null}for(d=0;d<e;++d){if(b[d].ad_rotation_order<c){c=b[d].ad_rotation_order;a=d}}return b[a]},display:function(e){var b=RotateAd.find(e);var d,a,c;if(b==-1){return}d=RotateAd.list[b];if(d.list.length==0){return}if(d.side==0&&d.mode==0&&d.algo==0){d.list[0].show();return}if(d.mode==RotateAd.ZT_MODE_ORDER){if(d.algo!=RotateAd.ZT_ALGO_PRI_ORDER&&d.algo!=RotateAd.ZT_ALGO_ORDER){RotateAd.error(e,"mode is order, but algo is "+d.algo);return}}else{if(d.mode==RotateAd.ZT_MODE_WEIGHT){if(d.algo!=RotateAd.ZT_ALGO_PRI_WEIGHT&&d.algo!=RotateAd.ZT_ALGO_WEIGHT&&d.algo!=RotateAd.ZT_ALGO_PRI_WEIGHT_MUL){RotateAd.error(e,"mode is weight, but algo is "+d.algo);return}}else{RotateAd.error(e,"wrong mode from xad "+d.mode);return}}switch(d.algo){case RotateAd.ZT_ALGO_PRI_ORDER:a=RotateAd.select_by_priority(d.list);if(a.length>=1){c=RotateAd.select_by_order(a);if(c!=null){c.show()}}break;case RotateAd.ZT_ALGO_ORDER:c=RotateAd.select_by_order(d.list);if(c!=null){c.show()}break;case RotateAd.ZT_ALGO_PRI_WEIGHT:a=RotateAd.select_by_priority(d.list);if(a.length>=1){c=RotateAd.select_by_weight(a);if(c!=null){c.show()}}break;case RotateAd.ZT_ALGO_WEIGHT:c=RotateAd.select_by_weight(d.list);if(c!=null){c.show()}break;case RotateAd.ZT_ALGO_PRI_WEIGHT_MUL:a=RotateAd.fix_weight(d.list);if(a.length>=1){c=RotateAd.select_by_weight(a);if(c!=null){c.show()}}break;default:RotateAd.error(e,"unkown algorithm "+d.algo)}}};cn.diny.AdObj=function(){this.content="";this.channel_rotation_side=RotateAd.ZT_ROTATION_CLIENT;this.channel_rotation_mode=RotateAd.ZT_MODE_WEIGHT;this.channel_delivery_algorithm=RotateAd.ZT_ALGO_WEIGHT;this.ad_rotation_weight=0;this.ad_priority_level=0;this.ad_rotation_order=0};cn.diny.AdObj.prototype={show:function(){document.write(this.content)}}};